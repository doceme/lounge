
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <title>Indexes Â· Lounge</title>
        <meta charset="UTF-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.0">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-prism/prism.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="events.html" />
    
    
    <link rel="prev" href="population.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">Guide</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="modeling.html">
            
                <a href="modeling.html">
            
                    
                    Modeling
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="types.html">
            
                <a href="types.html">
            
                    
                    Types
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="middleware.html">
            
                <a href="middleware.html">
            
                    
                    Middleware
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="extend.html">
            
                <a href="extend.html">
            
                    
                    Schema Extension
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="embedded.html">
            
                <a href="embedded.html">
            
                    
                    Embedded Documents 
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.7" data-path="docops.html">
            
                <a href="docops.html">
            
                    
                    Document Operations
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.8" data-path="population.html">
            
                <a href="population.html">
            
                    
                    Population
            
                </a>
            

            
        </li>
    
        <li class="chapter active" data-level="1.9" data-path="indexes.html">
            
                <a href="indexes.html">
            
                    
                    Indexes
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.10" data-path="events.html">
            
                <a href="events.html">
            
                    
                    Events
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.11" data-path="promises.html">
            
                <a href="promises.html">
            
                    
                    Promises
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.12" data-path="api.html">
            
                <a href="api.html">
            
                    
                    API Reference
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.13" data-path="glossary.html">
            
                <a href="glossary.html">
            
                    
                    Glossary
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >Indexes</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h2 id="indexes-">Indexes <a id="indexes"></a></h2><p>Lounge provides Indexing mechanism using <a href="http://docs.couchbase.com/developer/dev-guide-3.0/lookups.html" target="_blank">reference lookup documents</a>.
This allows us to set up simple lookups for easier document retrieval where we do not need to do create view
indexes. Specifying an <a href="glossary.html#index" class="glossary-term" title="A mechanism for looking up documents by means other than primary key / id. Currently Lounge itself only supports
automatic indexing and lookup using reference lookup documents.
Other indexing can be accomplished using views
and N1QL. These can be easily
added to models and lounge by using existing functionality and extending it.">index</a> property is done at <a href="glossary.html#schema" class="glossary-term" title="A schema defines all the properties, methods and behavior of a model. Schemas can extend other schemas and inherit
properties, methods and middleware.">schema</a> level:</p><pre><code class="lang-js"><span class="token keyword">var</span> userSchema <span class="token operator">=</span> lounge<span class="token punctuation">.</span><span class="token function">schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
  email<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> String<span class="token punctuation">,</span> index<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Here we wish <code>User</code> models to have their own <code>id</code> as <a href="glossary.html#document-key" class="glossary-term" title="A document must have a primary key. It is used to look up the document within the database. If a key property
isn&apos;t specified within a model schema, Lounge automatically creates one named id.">document key</a>, but we want to be able to look up documents via email
as well as that is also unique property for users. Lounge will automatically manage (remove and upsert) lookup documents,
as user is <code>saved</code> or <code>removed</code>.</p><pre><code class="lang-js"><span class="token keyword">var</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> <span class="token string">&apos;Joe Smith&apos;</span><span class="token punctuation">,</span>
  email<span class="token punctuation">:</span> <span class="token string">&apos;joe@gmail.com&apos;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

user<span class="token punctuation">.</span><span class="token function">save</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>This will create the a lookup document similar to:</p><pre><code class="lang-json"><span class="token punctuation">{</span> <span class="token property">&quot;key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;2ba8a471-063b-420a-aa83-31debe58f46f&quot;</span> <span class="token punctuation">}</span></code></pre>
<p>with <a href="glossary.html#document-key" class="glossary-term" title="A document must have a primary key. It is used to look up the document within the database. If a key property
isn&apos;t specified within a model schema, Lounge automatically creates one named id.">document key</a> <code>&apos;$_ref_by_email_joe@gmail.com&apos;</code>. We can manipulate this behaviour using <a href="glossary.html#schema" class="glossary-term" title="A schema defines all the properties, methods and behavior of a model. Schemas can extend other schemas and inherit
properties, methods and middleware.">schema</a> options.</p><pre><code class="lang-js"><span class="token keyword">var</span> userSchema <span class="token operator">=</span> lounge<span class="token punctuation">.</span><span class="token function">schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
  email<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> String<span class="token punctuation">,</span> index<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token punctuation">{</span>
  keyPrefix<span class="token punctuation">:</span> <span class="token string">&apos;user::&apos;</span><span class="token punctuation">,</span>
  delimiter<span class="token punctuation">:</span> <span class="token string">&apos;::&apos;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Saving a document defined with this <a href="glossary.html#schema" class="glossary-term" title="A schema defines all the properties, methods and behavior of a model. Schemas can extend other schemas and inherit
properties, methods and middleware.">schema</a> will save user document with key <code>&apos;user::5c4bfd6d-9c80-452b-be3a-3e528e4f53f5&apos;</code>
and will save a lookup document with key <code>&apos;user::$_ref_by_email::joe@gmail.com&apos;</code>. Setting <code>refIndexKeyPrefix</code> can add
additional customization.</p><pre><code class="lang-js"><span class="token punctuation">{</span>
  keyPrefix<span class="token punctuation">:</span> <span class="token string">&apos;user::&apos;</span><span class="token punctuation">,</span>
  delimiter<span class="token punctuation">:</span> <span class="token string">&apos;::&apos;</span><span class="token punctuation">,</span>
  refIndexKeyPrefix<span class="token punctuation">:</span> <span class="token string">&apos;lookup_by_&apos;</span>
<span class="token punctuation">}</span></code></pre>
<p>This will result in lookup <a href="glossary.html#document-key" class="glossary-term" title="A document must have a primary key. It is used to look up the document within the database. If a key property
isn&apos;t specified within a model schema, Lounge automatically creates one named id.">document key</a> <code>user::lookup_by_email::joe@gmail.com</code>.</p><p>Indexes can also be arrays:</p><pre><code class="lang-js"><span class="token keyword">var</span> userSchema <span class="token operator">=</span> lounge<span class="token punctuation">.</span><span class="token function">schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> String
  usernames<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> String<span class="token punctuation">,</span> index<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>A lookup document will be generated for each value in the array. <a href="glossary.html#index" class="glossary-term" title="A mechanism for looking up documents by means other than primary key / id. Currently Lounge itself only supports
automatic indexing and lookup using reference lookup documents.
Other indexing can be accomplished using views
and N1QL. These can be easily
added to models and lounge by using existing functionality and extending it.">Index</a> lookup properties have to be of type <code>String</code> or
<code>Number</code>.</p><p><a href="glossary.html#index" class="glossary-term" title="A mechanism for looking up documents by means other than primary key / id. Currently Lounge itself only supports
automatic indexing and lookup using reference lookup documents.
Other indexing can be accomplished using views
and N1QL. These can be easily
added to models and lounge by using existing functionality and extending it.">Index</a> lookup documents are automatically managed by lounge when documents are saved and removed using <code>save()</code> and
<code>remove()</code> functions. You can also manually kick of this process by calling <code>index()</code> function on any <a href="glossary.html#model" class="glossary-term" title="Models are generated from schemas and represent implementation for interacting with the database.">model</a> instance.</p><h3 id="index-queries-">Index queries <a id="queries"></a></h3><p>Any indexed property the <a href="glossary.html#model" class="glossary-term" title="Models are generated from schemas and represent implementation for interacting with the database.">Model</a> will automatically get a <code>findBy*</code> static function for easier lookup.
For example code above:</p><pre><code class="lang-js"><span class="token keyword">var</span> User <span class="token operator">=</span> lounge<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&apos;User&apos;</span><span class="token punctuation">,</span> userSchema<span class="token punctuation">)</span><span class="token punctuation">;</span>

User<span class="token punctuation">.</span><span class="token function">findByEmail</span><span class="token punctuation">(</span><span class="token string">&apos;joe@gmail.com&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> doc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">else</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doc<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>We automatically singularize and camelize property key to derive the <a href="glossary.html#index" class="glossary-term" title="A mechanism for looking up documents by means other than primary key / id. Currently Lounge itself only supports
automatic indexing and lookup using reference lookup documents.
Other indexing can be accomplished using views
and N1QL. These can be easily
added to models and lounge by using existing functionality and extending it.">index</a> name. So <code>usernames</code> becomes <code>findByUsername</code>.
We can specify the <a href="glossary.html#index" class="glossary-term" title="A mechanism for looking up documents by means other than primary key / id. Currently Lounge itself only supports
automatic indexing and lookup using reference lookup documents.
Other indexing can be accomplished using views
and N1QL. These can be easily
added to models and lounge by using existing functionality and extending it.">index</a> &quot;name&quot; by passing along the <code>indexName</code> property. For example:</p><pre><code class="lang-js"><span class="token keyword">var</span> userSchema <span class="token operator">=</span> lounge<span class="token punctuation">.</span><span class="token function">schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> String
  usernames<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> String<span class="token punctuation">,</span> index<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> indexName<span class="token punctuation">:</span> <span class="token string">&apos;UN&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> User <span class="token operator">=</span> lounge<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&apos;User&apos;</span><span class="token punctuation">,</span> userSchema<span class="token punctuation">)</span><span class="token punctuation">;</span>

User<span class="token punctuation">.</span><span class="token function">findByUN</span><span class="token punctuation">(</span><span class="token string">&apos;user1&apos;</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> doc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">else</span> console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>doc<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h3 id="array-index-type">Array index type</h3><p>If we can have multiple documents to be indexed by the same value then want the the reference lookup document to
store an array of document keys. This can be accomplished using <code>&apos;array&apos;</code> <code>indexType</code>.</p><pre><code class="lang-js"><span class="token keyword">var</span> userSchema <span class="token operator">=</span> lounge<span class="token punctuation">.</span><span class="token function">schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  email<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> String<span class="token punctuation">,</span> key<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> generate<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  username<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> String<span class="token punctuation">,</span> index<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> indexType<span class="token punctuation">:</span> <span class="token string">&apos;array&apos;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Here we <em>really</em> mean that multiple users can have the same nickname and we would like to <a href="glossary.html#index" class="glossary-term" title="A mechanism for looking up documents by means other than primary key / id. Currently Lounge itself only supports
automatic indexing and lookup using reference lookup documents.
Other indexing can be accomplished using views
and N1QL. These can be easily
added to models and lounge by using existing functionality and extending it.">index</a> both. Example:</p><pre><code class="lang-js"><span class="token keyword">var</span> user1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">{</span> email<span class="token punctuation">:</span> <span class="token string">&apos;bob@gmail.com&apos;</span><span class="token punctuation">,</span> nickname<span class="token punctuation">:</span> <span class="token string">&apos;bobby&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> user2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">{</span> email<span class="token punctuation">:</span> <span class="token string">&apos;robert@outlook.com&apos;</span><span class="token punctuation">,</span> nickname<span class="token punctuation">:</span> <span class="token string">&apos;bobby&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>When these two documents are indexed the lookup reference document with the key <code>&apos;$_ref_by_nickname_bobby&apos;</code> would
actually contain the keys to both our documents and would look like:</p><pre><code class="lang-json"><span class="token property">&quot;keys&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token string">&quot;bob@gmail.com&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;robert@outlook.com&quot;</span>
<span class="token punctuation">]</span></code></pre>
<p>Now if we call <code>User.findByNickname(&apos;bobby&apos;, ...)</code> the result would be 2 <code>User</code> instances. Array <a href="glossary.html#index" class="glossary-term" title="A mechanism for looking up documents by means other than primary key / id. Currently Lounge itself only supports
automatic indexing and lookup using reference lookup documents.
Other indexing can be accomplished using views
and N1QL. These can be easily
added to models and lounge by using existing functionality and extending it.">index</a> types can be
combined within an array field:</p><pre><code class="lang-js"><span class="token keyword">var</span> userSchema <span class="token operator">=</span> lounge<span class="token punctuation">.</span><span class="token function">schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  email<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> String<span class="token punctuation">,</span> key<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> generate<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  usernames<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span> type<span class="token punctuation">:</span> String<span class="token punctuation">,</span> index<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> indexType<span class="token punctuation">:</span> <span class="token string">&apos;array&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<h3 id="indexing-on-embedded-documents">Indexing on embedded documents</h3><p>Finally, indexing can be accomplished on embedded documents.</p><pre><code class="lang-js"><span class="token keyword">var</span> companySchema <span class="token operator">=</span> lounge<span class="token punctuation">.</span><span class="token function">schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  id<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> String<span class="token punctuation">,</span> key<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> generate<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  name<span class="token punctuation">:</span> String
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> userSchema <span class="token operator">=</span> lounge<span class="token punctuation">.</span><span class="token function">schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  email<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> String<span class="token punctuation">,</span> key<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> generate<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  company<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> Company<span class="token punctuation">,</span> index<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> company <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Company</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token string">&apos;acme_inc.&apos;</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">&apos;Acme Inc.&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> user <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">{</span> email<span class="token punctuation">:</span> <span class="token string">&apos;bob@gmail.com&apos;</span><span class="token punctuation">,</span> company<span class="token punctuation">:</span> company <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Here a lookup reference document will be created with key <code>&apos;$_ref_by_company_acme_inc.&apos;</code> and it will link to our <code>User</code>
document:</p><pre><code class="lang-json"><span class="token punctuation">{</span> <span class="token property">&quot;key&quot;</span><span class="token operator">:</span> <span class="token string">&quot;bob@gmail.com&quot;</span> <span class="token punctuation">}</span></code></pre>
<p>We can use <code>User.findByCompany(company.id, ...)</code> to get the <code>User</code> instance.</p><p>This example probably doesn&apos;t make much sense in real world. Multiple users can be associated with the same company,
so we really should use the <code>&apos;array&apos;</code> <a href="glossary.html#index" class="glossary-term" title="A mechanism for looking up documents by means other than primary key / id. Currently Lounge itself only supports
automatic indexing and lookup using reference lookup documents.
Other indexing can be accomplished using views
and N1QL. These can be easily
added to models and lounge by using existing functionality and extending it.">index</a> type.</p><pre><code class="lang-js"><span class="token keyword">var</span> companySchema <span class="token operator">=</span> lounge<span class="token punctuation">.</span><span class="token function">schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  id<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> String<span class="token punctuation">,</span> key<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> generate<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  name<span class="token punctuation">:</span> String
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> userSchema <span class="token operator">=</span> lounge<span class="token punctuation">.</span><span class="token function">schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  email<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> String<span class="token punctuation">,</span> key<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> generate<span class="token punctuation">:</span> <span class="token boolean">false</span> <span class="token punctuation">}</span><span class="token punctuation">,</span>
  company<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> Company<span class="token punctuation">,</span> index<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> indexType<span class="token punctuation">:</span> <span class="token string">&apos;array&apos;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> company <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Company</span><span class="token punctuation">(</span><span class="token punctuation">{</span> id<span class="token punctuation">:</span> <span class="token string">&apos;acme_inc.&apos;</span><span class="token punctuation">,</span> name<span class="token punctuation">:</span> <span class="token string">&apos;Acme Inc.&apos;</span> <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> user1 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">{</span> email<span class="token punctuation">:</span> <span class="token string">&apos;bob@gmail.com&apos;</span><span class="token punctuation">,</span> company<span class="token punctuation">:</span> company <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">var</span> user2 <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">User</span><span class="token punctuation">(</span><span class="token punctuation">{</span> email<span class="token punctuation">:</span> <span class="token string">&apos;joe@outlook.com&apos;</span><span class="token punctuation">,</span> company<span class="token punctuation">:</span> company <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>Here now the company lookup reference document will have contents:</p><pre><code class="lang-json"><span class="token property">&quot;keys&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
  <span class="token string">&quot;bob@gmail.com&quot;</span><span class="token punctuation">,</span>
  <span class="token string">&quot;joe@outlook.com&quot;</span>
<span class="token punctuation">]</span></code></pre>
<p>We can use <code>User.findByCompany(company.id, ...)</code> to get both <code>User</code> instances.</p><h3 id="lean-queries">Lean Queries</h3><p>Sometimes we may only be interested in the <a href="glossary.html#index" class="glossary-term" title="A mechanism for looking up documents by means other than primary key / id. Currently Lounge itself only supports
automatic indexing and lookup using reference lookup documents.
Other indexing can be accomplished using views
and N1QL. These can be easily
added to models and lounge by using existing functionality and extending it.">index</a> key value(s), and we do not actually wish to get the target document(s)
and create the <a href="glossary.html#model" class="glossary-term" title="Models are generated from schemas and represent implementation for interacting with the database.">model</a> instances. This can be accomplished using <code>lean</code> option:</p><pre><code class="lang-js"><span class="token keyword">var</span> userSchema <span class="token operator">=</span> lounge<span class="token punctuation">.</span><span class="token function">schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
  email<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> String<span class="token punctuation">,</span> index<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// ...</span>

User<span class="token punctuation">.</span><span class="token function">findByEmail</span><span class="token punctuation">(</span><span class="token string">&apos;joe@gmail.com&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> lean<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> rdoc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>rdoc<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// &apos;8bfda30c-604f-495c-a945-4c2e5ad123ad&apos;</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>This also works with array types:</p><pre><code class="lang-js"><span class="token keyword">var</span> userSchema <span class="token operator">=</span> lounge<span class="token punctuation">.</span><span class="token function">schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
  email<span class="token punctuation">:</span> <span class="token punctuation">{</span> type<span class="token punctuation">:</span> String<span class="token punctuation">,</span> index<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> indexType<span class="token punctuation">:</span> <span class="token string">&apos;array&apos;</span> <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// ...</span>

User<span class="token punctuation">.</span><span class="token function">findByEmail</span><span class="token punctuation">(</span><span class="token string">&apos;joe@gmail.com&apos;</span><span class="token punctuation">,</span> <span class="token punctuation">{</span> lean<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> rdoc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>rdoc<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// [ &apos;4c2e5ad1-604f-495c-a945-8bfda30c23ad&apos;, &apos;b81134d5-24ac-408b-b2d6-40a33a057f50&apos; ]</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>And similarly with embedded documents:</p><pre><code class="lang-js"><span class="token keyword">var</span> companySchema <span class="token operator">=</span> lounge<span class="token punctuation">.</span><span class="token function">schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  name<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
  address<span class="token punctuation">:</span> String
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Company <span class="token operator">=</span> lounge<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&apos;Company&apos;</span><span class="token punctuation">,</span> companySchema<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">var</span> userSchema <span class="token operator">=</span> lounge<span class="token punctuation">.</span><span class="token function">schema</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
  firstName<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
  lastName<span class="token punctuation">:</span> String<span class="token punctuation">,</span>
  email<span class="token punctuation">:</span> <span class="token punctuation">{</span>type<span class="token punctuation">:</span> String<span class="token punctuation">,</span> key<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span> generate<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  company<span class="token punctuation">:</span> <span class="token punctuation">{</span>type<span class="token punctuation">:</span> Company<span class="token punctuation">,</span> index<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

User <span class="token operator">=</span> lounge<span class="token punctuation">.</span><span class="token function">model</span><span class="token punctuation">(</span><span class="token string">&apos;User&apos;</span><span class="token punctuation">,</span> userSchema<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment" spellcheck="true">// ...</span>

User<span class="token punctuation">.</span><span class="token function">findByCompany</span><span class="token punctuation">(</span>companyId<span class="token punctuation">,</span> <span class="token punctuation">{</span> lean<span class="token punctuation">:</span> <span class="token boolean">true</span> <span class="token punctuation">}</span><span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> rdoc<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span>rdoc<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// joe@gmail.com</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="population.html" class="navigation navigation-prev " aria-label="Previous page: Population">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="events.html" class="navigation navigation-next " aria-label="Next page: Events">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Indexes","level":"1.9","depth":1,"next":{"title":"Events","level":"1.10","depth":1,"path":"events.md","ref":"events.md","articles":[]},"previous":{"title":"Population","level":"1.8","depth":1,"path":"population.md","ref":"population.md","articles":[]},"dir":"ltr"},"config":{"plugins":["prism","-highlight","github"],"root":"./docs","styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"github":{"url":"https://github.com/bojand/lounge"},"prism":{},"search":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"sharing":{"facebook":true,"twitter":true,"google":false,"weibo":false,"instapaper":false,"vk":false,"all":["facebook","google","twitter","weibo","instapaper"]},"fontsettings":{"theme":"white","family":"sans","size":2},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":false}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"readme.md","glossary":"glossary.md","summary":"summary.md"},"variables":{},"title":"Lounge","gitbook":">=3.0.0"},"file":{"path":"indexes.md","mtime":"2016-08-20T01:32:24.000Z","type":"markdown"},"gitbook":{"version":"3.2.0","time":"2016-09-06T00:52:09.291Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-sharing/buttons.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

